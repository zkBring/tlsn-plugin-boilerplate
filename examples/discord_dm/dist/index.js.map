{
  "version": 3,
  "sources": ["../../../src/utils/hf.js", "../src/index.ts"],
  "sourcesContent": ["function redirect(url) {\n  const { redirect } = Host.getFunctions();\n  const mem = Memory.fromString(url);\n  redirect(mem.offset);\n}\n\nfunction notarize(options) {\n  const { notarize } = Host.getFunctions();\n  const mem = Memory.fromString(JSON.stringify(options));\n  const idOffset = notarize(mem.offset);\n  const id = Memory.find(idOffset).readString();\n  return id;\n}\n\nfunction outputJSON(json) {\n  Host.outputString(\n    JSON.stringify(json),\n  );\n}\n\nfunction getCookiesByHost(hostname) {\n  const cookies = JSON.parse(Config.get('cookies'));\n  if (!cookies[hostname]) throw new Error(`cannot find cookies for ${hostname}`);\n  return cookies[hostname];\n}\n\nfunction getHeadersByHost(hostname) {\n  const headers = JSON.parse(Config.get('headers'));\n  if (!headers[hostname]) throw new Error(`cannot find headers for ${hostname}`);\n  return headers[hostname];\n}\n\nfunction getLocalStorageByHost(hostname) {\n  const localStorage = JSON.parse(Config.get('localStorage'));\n  if (!localStorage[hostname]) throw new Error(`cannot find local storage for ${hostname}`);\n  return localStorage[hostname];\n}\n\nfunction getSessionStorageByHost(hostname) {\n  const sessionStorage = JSON.parse(Config.get('sessionStorage'));\n  if (!sessionStorage[hostname]) throw new Error(`cannot find session storage for ${hostname}`);\n  return sessionStorage[hostname];\n}\n\nmodule.exports = {\n  redirect,\n  notarize,\n  outputJSON,\n  getCookiesByHost,\n  getHeadersByHost,\n  getLocalStorageByHost,\n  getSessionStorageByHost,\n};\n", "import { redirect, notarize, outputJSON, getHeadersByHost } from '../../../src/utils/hf';\n\n\nfunction isValidHost(urlString: string) {\n  const url = new URL(urlString);\n  return url.hostname === 'discord.com' || url.hostname === 'discord.gg'\n}\n\nfunction extractConversationId(urlString: string) {\n  const url = new URL(urlString);\n  if (url.hostname === 'discord.com' && /\\/channels\\/@me\\/[0-9]+$/.test(url.pathname)) {\n    return url.pathname.split('/@me/')[1]\n  } else {\n    return url.pathname.split('/channels/')[1]\n  }\n}\n\n\nexport function start() {\n  const tabUrl = Config.get('tabUrl');\n  if (tabUrl && !isValidHost(tabUrl)) {\n    redirect('https://discord.com/channels/@me')\n    outputJSON(false);\n    return;\n  }\n  outputJSON(true);\n}\n\n\nexport function two() {\n  const conversationId = extractConversationId(Config.get('tabUrl') ?? '');\n  // const cookies = JSON.parse(Config.get('cookies'))['discord.com'];\n  const headers = getHeadersByHost('discord.com');\n\n  // console.log(\"conversationId\");\n  // console.log(JSON.stringify(conversationId));\n  // console.log(JSON.stringify(headers['Authorization']));\n\n  if (\n    !conversationId ||\n    !headers['Authorization']\n  ) {\n    Host.outputString(JSON.stringify(false));\n    return;\n  }\n\n  outputJSON({\n    url: `https://discord.com/api/v9/channels/${conversationId}/messages?limit=2`,\n    method: 'GET',\n    headers: {\n      Host: 'discord.com',\n      Accept: '*/*',\n      'Accept-Encoding': 'identity',\n      'User-Agent': headers['User-Agent'],\n      Authorization: headers['Authorization'],\n      Connection: 'close'\n    },\n    secretHeaders: [\n      `authorization: ${headers['Authorization']}`\n    ]\n\n  })\n}\n\nexport function parseDiscordDm() {\n  const bodyString = Host.inputString();\n  const params = JSON.parse(bodyString);\n\n  if (params[0].content) {\n    const revealed = `\"content\":\"${params[0].content}\"`;\n    const selectionStart = bodyString.indexOf(revealed);\n    const selectionEnd = selectionStart + revealed.length;\n    const secretResps = [\n      bodyString.substring(0, selectionStart),\n      bodyString.substring(selectionEnd, bodyString.length),\n    ];\n    outputJSON(secretResps);\n  } else {\n    outputJSON(false);\n  }\n}\n\n\nexport function three() {\n  const params = JSON.parse(Host.inputString());\n  if (!params) {\n    outputJSON(false);\n  } else {\n    const id = notarize({\n      ...params,\n      getSecretResponse: 'parseDiscordDm'\n    })\n    outputJSON(id);\n  }\n}\n\nexport function config() {\n  outputJSON({\n    title: 'Discord DMs',\n    description: 'Notarize your Discord DMs',\n\n    steps: [\n      {\n        title: \"Goto Discord DM's\",\n        description: \"Log in to your discord if you haven't already\",\n        cta: \"Go to discord.com\",\n        action: 'start'\n      },\n      {\n        title: 'Open the DM you want to notarize',\n        description: \"Pick a short conversation (to meet the current size limits)\",\n        cta: 'Check',\n        action: 'two'\n      },\n      {\n        title: 'Notarize DM',\n        cta: 'Notarize',\n        action: 'three',\n        prover: true\n      }\n    ],\n    hostFunctions: ['redirect', 'notarize'],\n    headers: ['discord.com'],\n    requests: [\n      {\n        url: `https://discord.com/api/v9/channels/*/messages?limit=2`,\n        method: 'GET',\n      },\n    ],\n  })\n}\n"],
  "mappings": "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",
  "names": ["module", "redirect", "notarize", "outputJSON", "getHeadersByHost"]
}
